C51 COMPILER V9.59.0.0   UART                                                              10/08/2019 12:53:16 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\uart.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE uart.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\SRC) DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\uart.lst) OBJECT(.\Objects\uart.obj)

line level    source

   1          #include "REG52.h"
   2          extern void uartDel(unsigned char dat);
   3          #include "uart.h"
   4          xdata u8 USART_RX_BUF[USART_REC_LEN];     //接收缓冲,最大USART_REC_LEN个字节.
   5          //接收状态
   6          //bit15，       接收完成标志
   7          //bit14，       接收到0x0d
   8          //bit13~0，     接收到的有效字节数目
   9          u16 USART_RX_STA=0;       //接收状态标记        
  10          bit E_uart_send=1;       //发送使能
  11          void InitUART(void)
  12          {
  13   1               TMOD = 0x20;
  14   1          SCON = 0x50;
  15   1          TH1 = 0xFD;
  16   1          TL1 = TH1;
  17   1          PCON = 0x00;
  18   1          EA = 1;
  19   1          ES = 1;
  20   1          TR1 = 1;
  21   1      
  22   1      }
  23          void SendOneByte(unsigned char c)
  24          {
  25   1              if(E_uart_send){
  26   2                      SBUF = c;
  27   2                      while(!TI);
  28   2                      TI = 0;
  29   2              }
  30   1                      
  31   1      }
  32          void SendString(unsigned char *p,unsigned char len)
  33          {
  34   1              unsigned char t;
  35   1              for(t=0;t<len;t++)
  36   1              {
  37   2                      SendOneByte(p[t]);
  38   2              }
  39   1      }
  40          void UARTInterrupt(void) interrupt 4
  41          {
  42   1      //      u8 Res;
  43   1          if(RI)
  44   1          {
  45   2              RI = 0; 
  46   2                      uartDel(SBUF);
  47   2      //              Res =SBUF;      //读取接收到的数据              
  48   2      //              if((USART_RX_STA&0x8000)==0)//接收未完成
  49   2      //              {
  50   2      //                      if(USART_RX_STA&0x4000)//接收到了0x0d
  51   2      //                      {
  52   2      //                              if(Res!=0x0a)USART_RX_STA=0;//接收错误,重新开始
  53   2      //                              else {
  54   2      //                                      USART_RX_STA|=0x8000;   //接收完成了 
C51 COMPILER V9.59.0.0   UART                                                              10/08/2019 12:53:16 PAGE 2   

  55   2      //                                      /*****************************************/
  56   2      ////                                    uartPwdDeal(USART_RX_BUF);//判断是否为密码并处理
  57   2      ////                                    ESP8266_deal(USART_RX_BUF);//WiFi状态判断
  58   2      ////                                    //SendOneByte(ESP8266_state+'0');
  59   2      ////                    
  60   2      //                                      USART_RX_STA=0;
  61   2      //                                      /********************************************/
  62   2      //                              }
  63   2      //                      }
  64   2      //                      else //还没收到0X0D
  65   2      //                      {       
  66   2      //                              if(Res==0x0d)
  67   2      //                                              USART_RX_STA|=0x4000;
  68   2      //                              else
  69   2      //                              {
  70   2      //                                      USART_RX_BUF[USART_RX_STA&0X3FFF]=Res ;
  71   2      //                                      USART_RX_STA++;
  72   2      //                                      if(USART_RX_STA>(USART_REC_LEN-1))
  73   2      //                                              USART_RX_STA=0;//接收数据错误,重新开始接收        
  74   2      //                              }                
  75   2      //                      }
  76   2      //              }                
  77   2           
  78   2          }
  79   1      
  80   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    134    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     20    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
