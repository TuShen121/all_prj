C51 COMPILER V9.59.0.0   UART                                                              10/08/2019 12:32:09 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\uart.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE uart.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\SRC) DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\uart.lst) OBJECT(.\Objects\uart.obj)

line level    source

   1          #include "REG52.h"
   2          extern void uartDel(unsigned char dat);
   3          #include "uart.h"
   4          void InitUART(void)
   5          {
   6   1               TMOD = 0x20;
   7   1          SCON = 0x50;
   8   1          TH1 = 0xFA;
   9   1          TL1 = TH1;
  10   1          PCON = 0x00;
  11   1          EA = 1;
  12   1          ES = 1;
  13   1          TR1 = 1;
  14   1      
  15   1      }
  16          void SendOneByte(unsigned char c)
  17          {
  18   1              SBUF = c;
  19   1              while(!TI);
  20   1              TI = 0; 
  21   1      }
  22          void SendString(unsigned char *p,unsigned char len)
  23          {
  24   1              unsigned char t;
  25   1              for(t=0;t<len;t++)
  26   1              {
  27   2                      SendOneByte(p[t]);
  28   2              }
  29   1      }
  30          void UARTInterrupt(void) interrupt 4
  31          {
  32   1      //      u8 Res;
  33   1          if(RI)
  34   1          {
  35   2              RI = 0; 
  36   2      //              Res =SBUF;      //读取接收到的数据              
  37   2                      uartDel(SBUF);
  38   2      //              if((USART_RX_STA&0x8000)==0)//接收未完成
  39   2      //              {
  40   2      //                      if(USART_RX_STA&0x4000)//接收到了0x0d
  41   2      //                      {
  42   2      //                              if(Res!=0x0a)USART_RX_STA=0;//接收错误,重新开始
  43   2      //                              else {
  44   2      //                                      USART_RX_STA|=0x8000;   //接收完成了 
  45   2      //                                      /*****************************************/
  46   2      ////                                    uartPwdDeal(USART_RX_BUF);//判断是否为密码并处理
  47   2      ////                                    ESP8266_deal(USART_RX_BUF);//WiFi状态判断
  48   2      ////                                    //SendOneByte(ESP8266_state+'0');
  49   2      ////                    
  50   2      ////                                    USART_RX_STA=0;
  51   2      //                                      /********************************************/
  52   2      //                              }
  53   2      //                      }
  54   2      //                      else //还没收到0X0D
C51 COMPILER V9.59.0.0   UART                                                              10/08/2019 12:32:09 PAGE 2   

  55   2      //                      {       
  56   2      //                              if(Res==0x0d)
  57   2      //                                              USART_RX_STA|=0x4000;
  58   2      //                              else
  59   2      //                              {
  60   2      //                                      USART_RX_BUF[USART_RX_STA&0X3FFF]=Res ;
  61   2      //                                      USART_RX_STA++;
  62   2      //                                      if(USART_RX_STA>(USART_REC_LEN-1))
  63   2      //                                              USART_RX_STA=0;//接收数据错误,重新开始接收        
  64   2      //                              }                
  65   2      //                      }
  66   2      //              }                
  67   2           
  68   2          }
  69   1      
  70   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    131    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
