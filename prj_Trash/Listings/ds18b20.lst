C51 COMPILER V9.59.0.0   DS18B20                                                           10/14/2019 21:38:38 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN .\Objects\ds18b20.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ds18b20.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\SRC) DEBUG OBJECTEXTEND PRIN
                    -T(.\Listings\ds18b20.lst) OBJECT(.\Objects\ds18b20.obj)

line level    source

   1          #include "ds18b20.h"
   2          //ÎÂ¶ÈÏÔÊ¾³ÌÐò==LEDÏÔÊ¾£¬¾«¶È0.1ÉãÊÏ¶È
   3          //¾§Õñ:12M
   4          //µ¥Æ¬»ú£ºstc12c5a60s2   1T
   5          /******************************************
   6          ÌøÏßÉèÖÃ:Ä¬ÈÏ
   7          ×¢ÒâÊÂÏî:ds18b20ÇÐÎð²å·´£¬ÓÐ±¬Õ¨ÌÌÉËµÄÎ£ÏÕ£¬·½ÏòÊÇds18b20µÄÆ½Ãæ£¨ÓÐ×ÖµÄÒ»Ãæ£©³¯ÅÔ±ßµÄÈý¼«¹ÜQ4
   8          ***/
   9          #include <reg51.h>
  10          #include <intrins.h>
  11          #define uchar unsigned char
  12          #define uint unsigned int
  13          //Êý¾Ý¿Údefine interface
  14          
  15          sbit DQ = P1^0;          //18b20½Ó¿Ú
  16          
  17          uint wendu;                //ÎÂ¶ÈÖµ variable of wenduerature
  18          
  19          //²»´øÐ¡Êýµã
  20          unsigned char code table[] = {0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,
  21                   0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};
  22          //´øÐ¡Êýµã
  23          unsigned char code table1[] = {0xbf,0x86,0xdb,0xcf,0xe6,0xed,0xfd,0x87,0xff,0xef};
  24          
  25          
  26          /*************¾«È·ÑÓÊ±º¯Êý**************** */
  27          //                          Êý¾Ý±íÈçÏÂ
  28          /*
  29          **********************************************************************************************************
             -**********
  30          ÑÓÊ±Ê±¼ä      aµÄÖµ     bµÄÖµ       cµÄÖµ     ÑÓÊ±Îó²î£¨us£©
  31          10us          1           1           1            -0.5    
  32          20us          1           1           8            0  
  33          30us          1           1           15           +0.5 
  34          40us          2           1           9            0  
  35          50us          1           1           28            0  
  36          60us          1           1           35           +0.5 
  37          70us          1           1           42           +1 
  38          80us          1           1           48            0 
  39          90us          1           1           55           +0.5  
  40          100us         1           1           61           -0.5  
  41          200us         1           1           128           0  
  42          300us         3           1           63           +1.5  
  43          400us         2           1           129           0  
  44          500us         5           1           63           +0.5  
  45          600us         6           1           63            0  
  46          700us         7           1           63            -0.5  
  47          800us         1           3           175           +0.5  
  48          900us         9           1           63            -1.5  
  49          1ms           1           3           219           -1.5
  50          2ms           2           3           220           +3
  51          3ms           3           3           220           +3
  52          Xms           X           3           220           +3     
  53                 (XµÄ·¶Î§Îª2µ½255)
C51 COMPILER V9.59.0.0   DS18B20                                                           10/14/2019 21:38:38 PAGE 2   

  54          */
  55          
  56          void Delay(unsigned char a1,b1,c1)
  57          {
  58   1       unsigned char a,b,c;
  59   1      for(a=0;a<a1;a++)
  60   1      for(b=0;b<b1;b++)
  61   1      for(c=0;c<c1;c++);
  62   1      }
  63          
  64          /*****************DS18B20******************/ 
  65          void Init_Ds18b20(void)     //DS18B20³õÊ¼»¯send reset and initialization command
  66          {
  67   1      DQ = 1;                     //DQ¸´Î»,²»ÒªÒ²¿ÉÐÐ¡£
  68   1      Delay(1,1,1);                  //ÉÔ×öÑÓÊ±  10us
  69   1      DQ = 0;                    //µ¥Æ¬»úÀ­µÍ×ÜÏß
  70   1      Delay(6,1,63); //600  us      //¾«È·ÑÓÊ±£¬Î¬³ÖÖÁÉÙ480us
  71   1      //Delay(1,1,15); //20us
  72   1      DQ = 1;                    //ÊÍ·Å×ÜÏß£¬¼´À­¸ßÁË×ÜÏß
  73   1      Delay(5,1,63); //500us               //´Ë´¦ÑÓÊ±ÓÐ×ã¹»,È·±£ÄÜÈÃDS18B20·¢³ö´æÔÚÂö³å¡£
  74   1      }
  75          
  76          uchar Read_One_Byte()       //¶ÁÈ¡Ò»¸ö×Ö½ÚµÄÊý¾Ýread a byte date
  77                                      //¶ÁÊý¾ÝÊ±,Êý¾ÝÒÔ×Ö½ÚµÄ×îµÍÓÐÐ§Î»ÏÈ´Ó×ÜÏßÒÆ³ö
  78          {
  79   1      uchar i   = 0;
  80   1      uchar dat = 0;
  81   1      for(i=8;i>0;i--)
  82   1         {
  83   2         DQ = 0;                  //½«×ÜÏßÀ­µÍ£¬ÒªÔÚ1usÖ®ºóÊÍ·Å×ÜÏß
  84   2                                 //µ¥Æ¬»úÒªÔÚ´ËÏÂ½µÑØºóµÄ15usÄÚ¶ÁÊý¾Ý²Å»áÓÐÐ§¡£
  85   2         _nop_();                 //ÖÁÉÙÎ¬³ÖÁË1us,±íÊ¾¶ÁÊ±Ðò¿ªÊ¼
  86   2         dat >>= 1;               //ÈÃ´Ó×ÜÏßÉÏ¶Áµ½µÄÎ»Êý¾Ý£¬ÒÀ´Î´Ó¸ßÎ»ÒÆ¶¯µ½µÍÎ»¡£
  87   2         DQ = 1;                  //ÊÍ·Å×ÜÏß£¬´ËºóDS18B20»á¿ØÖÆ×ÜÏß,°ÑÊý¾Ý´«Êäµ½×ÜÏßÉÏ
  88   2         Delay(1,1,1);        //ÑÓÊ±10us,´Ë´¦²ÎÕÕÍÆ¼öµÄ¶ÁÊ±ÐòÍ¼£¬¾¡Á¿°Ñ¿ØÖÆÆ÷²ÉÑùÊ±¼ä·Åµ½¶ÁÊ±ÐòºóµÄ15usÄÚµÄ×îºó²
             -¿·Ö
  89   2         if(DQ)                   //¿ØÖÆÆ÷½øÐÐ²ÉÑù
  90   2         {
  91   3          dat |= 0x80;            //Èô×ÜÏßÎª1,¼´DQÎª1,ÄÇ¾Í°ÑdatµÄ×î¸ßÎ»ÖÃ1;ÈôÎª0,Ôò²»½øÐÐ´¦Àí,±£³ÖÎª0
  92   3         }        
  93   2         Delay(1,1,8);       //20us        //´ËÑÓÊ±²»ÄÜÉÙ£¬È·±£¶ÁÊ±ÐòµÄ³¤¶È60us¡£
  94   2      }
  95   1      return (dat);
  96   1      }
  97          
  98          void Write_One_Byte(uchar dat)
  99          {
 100   1      uchar i = 0;
 101   1      for(i=8;i>0;i--)
 102   1      {
 103   2         DQ = 0;                        //À­µÍ×ÜÏß
 104   2         _nop_();                       //ÖÁÉÙÎ¬³ÖÁË1us,±íÊ¾Ð´Ê±Ðò(°üÀ¨Ð´0Ê±Ðò»òÐ´1Ê±Ðò)¿ªÊ¼
 105   2         DQ = dat&0x01;                 //´Ó×Ö½ÚµÄ×îµÍÎ»¿ªÊ¼´«Êä
 106   2                                       //Ö¸ÁîdatµÄ×îµÍÎ»¸³Óè¸ø×ÜÏß,±ØÐëÔÚÀ­µÍ×ÜÏßºóµÄ15usÄÚ,
 107   2                                       //ÒòÎª15usºóDS18B20»á¶Ô×ÜÏß²ÉÑù¡£
 108   2         Delay(1,1,15);               //±ØÐëÈÃÐ´Ê±Ðò³ÖÐøÖÁÉÙ60us
 109   2         DQ = 1;                        //Ð´Íêºó,±ØÐëÊÍ·Å×ÜÏß,
 110   2         dat >>= 1;
 111   2         Delay(1,1,1);
 112   2      }
 113   1      }
 114          
C51 COMPILER V9.59.0.0   DS18B20                                                           10/14/2019 21:38:38 PAGE 3   

 115          
 116          uint Get_Tmp()                   //»ñÈ¡ÎÂ¶Èget the wenduerature
 117          {
 118   1      float tt;
 119   1      uchar a,b;
 120   1      Init_Ds18b20();                //³õÊ¼»¯
 121   1      Write_One_Byte(0xcc);          //ºöÂÔROMÖ¸Áî
 122   1      Write_One_Byte(0x44);          //ÎÂ¶È×ª»»Ö¸Áî
 123   1      Init_Ds18b20();                 //³õÊ¼»¯
 124   1      Write_One_Byte(0xcc);          //ºöÂÔROMÖ¸Áî
 125   1      Write_One_Byte(0xbe);          //¶ÁÔÝ´æÆ÷Ö¸Áî
 126   1      a = Read_One_Byte();           //¶ÁÈ¡µ½µÄµÚÒ»¸ö×Ö½ÚÎªÎÂ¶ÈLSB
 127   1      b = Read_One_Byte();           //¶ÁÈ¡µ½µÄµÚÒ»¸ö×Ö½ÚÎªÎÂ¶ÈMSB
 128   1      wendu = b;                      //ÏÈ°Ñ¸ß°ËÎ»ÓÐÐ§Êý¾Ý¸³ÓÚwendu
 129   1      wendu <<= 8;                    //°ÑÒÔÉÏ8Î»Êý¾Ý´ÓwenduµÍ°ËÎ»ÒÆµ½¸ß°ËÎ»
 130   1      wendu = wendu|a;                //Á½×Ö½ÚºÏ³ÉÒ»¸öÕûÐÍ±äÁ¿
 131   1      tt = wendu*0.0625;              //µÃµ½ÕæÊµÊ®½øÖÆÎÂ¶ÈÖµ
 132   1                                      //ÒòÎªDS18B20¿ÉÒÔ¾«È·µ½0.0625¶È
 133   1                                      //ËùÒÔ¶Á»ØÊý¾ÝµÄ×îµÍÎ»´ú±íµÄÊÇ0.0625¶È
 134   1      wendu = tt*10+0.5;               //·Å´óÊ®±¶
 135   1                                      //ÕâÑù×öµÄÄ¿µÄ½«Ð¡ÊýµãºóµÚÒ»Î»Ò²×ª»»Îª¿ÉÏÔÊ¾Êý×Ö
 136   1                                      //Í¬Ê±½øÐÐÒ»¸öËÄÉáÎåÈë²Ù×÷¡£
 137   1      return wendu;
 138   1      }
 139          
 140          
 141          /****************ÊýÂëÂë¶¯Ì¬ÏÔÊ¾º¯Êý**************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    301    ----
   CONSTANT SIZE    =     26    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
