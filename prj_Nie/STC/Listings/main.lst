C51 COMPILER V9.59.0.0   MAIN                                                              10/19/2019 18:41:23 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\SRC) DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "reg51.h"
   2          #include "intrins.h"
   3          #include "config.h"
   4          #include "oled.h"
   5          #include "bmp.h"
   6          #include "ds18b20.h"
   7          #include "stdio.h"
   8          #include "uart.h"
   9          
  10          unsigned char phonenum[]="AT+CMGS=\"17858366909\"";
  11          unsigned char alarmtex[]="Found the fire";
  12          void mDelay(unsigned int i)
  13          {
  14   1              while(i--);
  15   1      }
  16          void showInit()
  17          {
  18   1              unsigned char offset_x=0;
  19   1              offset_x=8;
  20   1              OLED_ShowCHinese(offset_x+0,0,0);//火
  21   1              OLED_ShowCHinese(offset_x+18,0,1);//灾
  22   1              OLED_ShowCHinese(offset_x+36,0,2);//报
  23   1              OLED_ShowCHinese(offset_x+54,0,3);//警
  24   1              OLED_ShowCHinese(offset_x+72,0,4);//系
  25   1              OLED_ShowCHinese(offset_x+90,0,5);//统
  26   1      
  27   1              OLED_ShowCHinese(0,2,6);//温
  28   1              OLED_ShowCHinese(18,2,7);//度
  29   1              
  30   1              OLED_ShowCHinese(0,4,8);//烟雾
  31   1              OLED_ShowCHinese(18,4,9);//
  32   1              OLED_ShowChar(40,4,'X',16);//烟雾
  33   1              
  34   1              OLED_ShowCHinese(54+5,4,10);//火焰
  35   1              OLED_ShowCHinese(72+5,4,11);//
  36   1              OLED_ShowChar(100,4,'X',16);//火焰
  37   1              
  38   1              OLED_ShowCHinese(0,6,6);//温阈
  39   1              OLED_ShowCHinese(18,6,12);//
  40   1      }
  41          
  42          void main()
  43          {
  44   1              unsigned char tempStr[5];
  45   1              float temp=0;
  46   1              static unsigned int tempE=30;
  47   1              unsigned int time=0;
  48   1              unsigned alarmFlag=0;
  49   1              P0M0|=0x08;
  50   1              P0M1|=0x08;
  51   1      
  52   1              P2M0|=0x80;
  53   1              P2M1|=0x80;
  54   1              
C51 COMPILER V9.59.0.0   MAIN                                                              10/19/2019 18:41:23 PAGE 2   

  55   1              
  56   1              InitUART();
  57   1              OLED_Init();//初始化OLED  
  58   1              OLED_Clear(); 
  59   1              showInit();
  60   1              mDelay(60000);
  61   1          while (1)
  62   1              {       
  63   2                      
  64   2                      
  65   2                      
  66   2                      temp=(float)Get_Tmp()/10;
  67   2                      mDelay(60000);
  68   2                      mDelay(60000);
  69   2                      if(temp>=(float)tempE ){//如果温度超过阈值
  70   3                              BEEP=0;
  71   3                              LED=0;
  72   3                              alarmFlag=1;
  73   3                      }
  74   2                      if(yanwu==0)//如果烟雾传感器报警
  75   2                      {
  76   3                              BEEP=0;
  77   3                              LED=0;
  78   3                              OLED_ShowChar(40,4,'Y',16);//烟雾
  79   3                              alarmFlag=1;
  80   3                      }else 
  81   2                      {
  82   3                              OLED_ShowChar(40,4,'X',16);//烟雾
  83   3                      }
  84   2                      if(huoyan==0)//如果火焰传感器报警
  85   2                      {
  86   3                              BEEP=0;
  87   3                              LED=0;
  88   3                              OLED_ShowChar(100,4,'Y',16);//火焰
  89   3                              alarmFlag=1;
  90   3                      }
  91   2                      else
  92   2                      {
  93   3                              OLED_ShowChar(100,4,'X',16);//火焰
  94   3                      }
  95   2                      if(temp<(float)tempE &&  yanwu!=0 && huoyan!=0){//如果三者都没有警报
  96   3                              BEEP=1;
  97   3                              LED=1;
  98   3                              alarmFlag=0;
  99   3                      }
 100   2                      
 101   2                      if(alarmFlag==1)//如果发生警报
 102   2                      {       
 103   3                              if(time==10)//刚开机的时候温度会乱码，所以等报警时间大于50个周期在发送短信，确保报警正确
 104   3                              {
 105   4                                      SendString(phonenum,21);
 106   4                                      SendOneByte(0x0d);
 107   4                                      mDelay(60000);
 108   4                                      SendString(alarmtex,14);
 109   4                                      SendOneByte(0x1a);
 110   4                              }
 111   3                              time++;
 112   3                              if(time>=1200){//10一秒  每两分钟发生一次
 113   4                                      time=0;
 114   4                              }       
 115   3                      }else
 116   2                      {
C51 COMPILER V9.59.0.0   MAIN                                                              10/19/2019 18:41:23 PAGE 3   

 117   3                              time=0;
 118   3                      }
 119   2                      
 120   2                      sprintf(tempStr,"%5f",temp);
 121   2                      tempStr[4]='\0';
 122   2                      OLED_ShowString(36,2,tempStr,16);        //显示温度
 123   2                      OLED_ShowNum(36,6,tempE,3,16);   //显示温度阈值
 124   2                      
 125   2                      if(KEY_UP==0)
 126   2                      {
 127   3                              mDelay(60000);
 128   3                              if(KEY_UP==0)
 129   3                                      tempE++;
 130   3                      }
 131   2                      else if(KEY_DWON==0)
 132   2                      {
 133   3                              mDelay(60000);
 134   3                              if(KEY_DWON==0)
 135   3                                      tempE--;
 136   3                      }
 137   2                      
 138   2              }
 139   1      }
 140          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    596    ----
   CONSTANT SIZE    =   2052    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     39      14
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
